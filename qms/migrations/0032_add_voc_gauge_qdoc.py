# Generated by Django 6.0 on 2026-01-24 15:10

import django.db.models.deletion
from django.conf import settings
from django.db import migrations, models


class Migration(migrations.Migration):

    dependencies = [
        ('orders', '0038_add_qms_detailed_permissions'),
        ('qms', '0031_add_claim_cost_and_isir'),
        migrations.swappable_dependency(settings.AUTH_USER_MODEL),
    ]

    operations = [
        migrations.CreateModel(
            name='Gauge',
            fields=[
                ('id', models.BigAutoField(auto_created=True, primary_key=True, serialize=False, verbose_name='ID')),
                ('gauge_no', models.CharField(max_length=30, unique=True, verbose_name='관리번호')),
                ('gauge_name', models.CharField(max_length=100, verbose_name='계측기명')),
                ('gauge_type', models.CharField(choices=[('CALIPER', '버니어캘리퍼스'), ('MICROMETER', '마이크로미터'), ('DIAL_GAUGE', '다이얼게이지'), ('HEIGHT_GAUGE', '하이트게이지'), ('SCALE', '저울'), ('THERMOMETER', '온도계'), ('PRESSURE', '압력계'), ('TORQUE', '토크렌치'), ('CMM', '3차원측정기'), ('TESTER', '시험기'), ('OTHER', '기타')], max_length=20, verbose_name='유형')),
                ('status', models.CharField(choices=[('ACTIVE', '사용중'), ('CALIBRATING', '교정중'), ('REPAIR', '수리중'), ('SCRAPPED', '폐기'), ('INACTIVE', '미사용')], default='ACTIVE', max_length=15, verbose_name='상태')),
                ('manufacturer', models.CharField(blank=True, max_length=100, verbose_name='제조사')),
                ('model_no', models.CharField(blank=True, max_length=50, verbose_name='모델번호')),
                ('serial_no', models.CharField(blank=True, max_length=50, verbose_name='시리얼번호')),
                ('measurement_range', models.CharField(blank=True, max_length=100, verbose_name='측정범위')),
                ('resolution', models.CharField(blank=True, max_length=50, verbose_name='분해능')),
                ('accuracy', models.CharField(blank=True, max_length=50, verbose_name='정밀도')),
                ('location', models.CharField(blank=True, max_length=100, verbose_name='설치장소')),
                ('department', models.CharField(blank=True, max_length=50, verbose_name='관리부서')),
                ('usage', models.CharField(blank=True, max_length=200, verbose_name='용도')),
                ('calibration_type', models.CharField(choices=[('INTERNAL', '사내교정'), ('EXTERNAL', '외부교정')], default='EXTERNAL', max_length=10, verbose_name='교정유형')),
                ('calibration_cycle', models.IntegerField(default=12, verbose_name='교정주기(월)')),
                ('last_calibration_date', models.DateField(blank=True, null=True, verbose_name='최근교정일')),
                ('next_calibration_date', models.DateField(blank=True, null=True, verbose_name='차기교정일')),
                ('calibration_agency', models.CharField(blank=True, max_length=100, verbose_name='교정기관')),
                ('purchase_date', models.DateField(blank=True, null=True, verbose_name='구입일')),
                ('purchase_cost', models.DecimalField(blank=True, decimal_places=0, max_digits=12, null=True, verbose_name='구입가격')),
                ('photo', models.FileField(blank=True, null=True, upload_to='qms/gauge/photos/', verbose_name='사진')),
                ('manual', models.FileField(blank=True, null=True, upload_to='qms/gauge/manuals/', verbose_name='매뉴얼')),
                ('remark', models.TextField(blank=True, verbose_name='비고')),
                ('created_at', models.DateTimeField(auto_now_add=True, verbose_name='등록일시')),
                ('updated_at', models.DateTimeField(auto_now=True, verbose_name='수정일시')),
                ('manager', models.ForeignKey(blank=True, null=True, on_delete=django.db.models.deletion.SET_NULL, related_name='managed_gauges', to=settings.AUTH_USER_MODEL, verbose_name='관리담당자')),
            ],
            options={
                'verbose_name': '계측기',
                'verbose_name_plural': '계측기 관리',
                'ordering': ['gauge_no'],
            },
        ),
        migrations.CreateModel(
            name='GaugeCalibration',
            fields=[
                ('id', models.BigAutoField(auto_created=True, primary_key=True, serialize=False, verbose_name='ID')),
                ('calibration_date', models.DateField(verbose_name='교정일')),
                ('calibration_type', models.CharField(choices=[('INTERNAL', '사내'), ('EXTERNAL', '외부')], max_length=10, verbose_name='교정유형')),
                ('calibration_agency', models.CharField(blank=True, max_length=100, verbose_name='교정기관')),
                ('result', models.CharField(choices=[('PASS', '합격'), ('FAIL', '불합격'), ('ADJUSTED', '조정후합격')], max_length=10, verbose_name='결과')),
                ('certificate_no', models.CharField(blank=True, max_length=50, verbose_name='성적서번호')),
                ('uncertainty', models.CharField(blank=True, max_length=100, verbose_name='측정불확도')),
                ('cost', models.DecimalField(blank=True, decimal_places=0, max_digits=10, null=True, verbose_name='교정비용')),
                ('next_date', models.DateField(blank=True, null=True, verbose_name='차기교정일')),
                ('certificate_file', models.FileField(blank=True, null=True, upload_to='qms/gauge/certificates/', verbose_name='교정성적서')),
                ('remark', models.TextField(blank=True, verbose_name='비고')),
                ('created_at', models.DateTimeField(auto_now_add=True, verbose_name='등록일시')),
                ('gauge', models.ForeignKey(on_delete=django.db.models.deletion.CASCADE, related_name='calibrations', to='qms.gauge', verbose_name='계측기')),
                ('performed_by', models.ForeignKey(blank=True, null=True, on_delete=django.db.models.deletion.SET_NULL, to=settings.AUTH_USER_MODEL, verbose_name='교정자/등록자')),
            ],
            options={
                'verbose_name': '교정이력',
                'verbose_name_plural': '교정이력',
                'ordering': ['-calibration_date'],
            },
        ),
        migrations.CreateModel(
            name='QualityDocument',
            fields=[
                ('id', models.BigAutoField(auto_created=True, primary_key=True, serialize=False, verbose_name='ID')),
                ('doc_no', models.CharField(max_length=50, unique=True, verbose_name='문서번호')),
                ('doc_name', models.CharField(max_length=200, verbose_name='문서명')),
                ('category', models.CharField(choices=[('MANUAL', '매뉴얼'), ('PROCEDURE', '절차서'), ('INSTRUCTION', '지시서/기준서'), ('FORM', '양식'), ('SPEC', '규격서'), ('DRAWING', '도면'), ('CONTROL_PLAN', '관리계획서'), ('FMEA', 'FMEA'), ('SOP', '작업표준서'), ('INSPECTION', '검사기준서'), ('OTHER', '기타')], max_length=20, verbose_name='문서유형')),
                ('status', models.CharField(choices=[('DRAFT', '작성중'), ('REVIEW', '검토중'), ('APPROVED', '승인'), ('OBSOLETE', '폐기')], default='DRAFT', max_length=15, verbose_name='상태')),
                ('version', models.CharField(default='1.0', max_length=20, verbose_name='버전')),
                ('revision', models.IntegerField(default=0, verbose_name='개정차수')),
                ('description', models.TextField(blank=True, verbose_name='문서설명')),
                ('file', models.FileField(upload_to='qms/documents/', verbose_name='문서파일')),
                ('file_name', models.CharField(max_length=200, verbose_name='파일명')),
                ('related_part_no', models.CharField(blank=True, max_length=50, verbose_name='관련품번')),
                ('related_process', models.CharField(blank=True, max_length=100, verbose_name='관련공정')),
                ('effective_date', models.DateField(verbose_name='시행일')),
                ('expiry_date', models.DateField(blank=True, null=True, verbose_name='만료일')),
                ('reviewed_at', models.DateTimeField(blank=True, null=True, verbose_name='검토일시')),
                ('approved_at', models.DateTimeField(blank=True, null=True, verbose_name='승인일시')),
                ('is_controlled', models.BooleanField(default=True, help_text='체크시 배포/회수 관리 대상', verbose_name='관리문서')),
                ('remark', models.TextField(blank=True, verbose_name='비고')),
                ('created_at', models.DateTimeField(auto_now_add=True, verbose_name='등록일시')),
                ('updated_at', models.DateTimeField(auto_now=True, verbose_name='수정일시')),
                ('approved_by', models.ForeignKey(blank=True, null=True, on_delete=django.db.models.deletion.SET_NULL, related_name='qdoc_approved', to=settings.AUTH_USER_MODEL, verbose_name='승인자')),
                ('created_by', models.ForeignKey(on_delete=django.db.models.deletion.PROTECT, related_name='qdoc_created', to=settings.AUTH_USER_MODEL, verbose_name='작성자')),
                ('reviewed_by', models.ForeignKey(blank=True, null=True, on_delete=django.db.models.deletion.SET_NULL, related_name='qdoc_reviewed', to=settings.AUTH_USER_MODEL, verbose_name='검토자')),
            ],
            options={
                'verbose_name': '품질문서',
                'verbose_name_plural': '품질문서 관리',
                'ordering': ['category', 'doc_no'],
            },
        ),
        migrations.CreateModel(
            name='VOC',
            fields=[
                ('id', models.BigAutoField(auto_created=True, primary_key=True, serialize=False, verbose_name='ID')),
                ('voc_no', models.CharField(max_length=30, unique=True, verbose_name='VOC번호')),
                ('status', models.CharField(choices=[('RECEIVED', '접수'), ('ANALYZING', '원인분석'), ('ACTION', '조치중'), ('VERIFY', '효과검증'), ('CLOSED', '완료')], default='RECEIVED', max_length=15, verbose_name='상태')),
                ('severity', models.CharField(choices=[('CRITICAL', '긴급'), ('MAJOR', '중대'), ('MINOR', '경미')], default='MINOR', max_length=10, verbose_name='심각도')),
                ('source', models.CharField(choices=[('FIELD', '필드클레임'), ('LINE_STOP', '라인스톱'), ('CUSTOMER_AUDIT', '고객감사'), ('COMPLAINT', '일반불만'), ('RETURN', '반품'), ('WARRANTY', '보증')], max_length=20, verbose_name='접수경로')),
                ('received_date', models.DateField(verbose_name='접수일')),
                ('customer_name', models.CharField(max_length=100, verbose_name='고객사')),
                ('customer_contact', models.CharField(blank=True, max_length=50, verbose_name='고객담당자')),
                ('customer_phone', models.CharField(blank=True, max_length=50, verbose_name='연락처')),
                ('part_no', models.CharField(max_length=50, verbose_name='품번')),
                ('part_name', models.CharField(max_length=100, verbose_name='품명')),
                ('lot_no', models.CharField(blank=True, max_length=50, verbose_name='LOT번호')),
                ('defect_qty', models.IntegerField(default=0, verbose_name='불량수량')),
                ('defect_type', models.CharField(max_length=100, verbose_name='불량유형')),
                ('defect_detail', models.TextField(verbose_name='불량상세')),
                ('photo', models.FileField(blank=True, null=True, upload_to='qms/voc/photos/', verbose_name='불량사진')),
                ('cause_analysis', models.TextField(blank=True, verbose_name='원인분석')),
                ('root_cause', models.TextField(blank=True, verbose_name='근본원인')),
                ('responsible_type', models.CharField(blank=True, choices=[('INTERNAL', '사내'), ('VENDOR', '협력사'), ('CUSTOMER', '고객')], max_length=20, verbose_name='귀책구분')),
                ('immediate_action', models.TextField(blank=True, verbose_name='즉시대책')),
                ('corrective_action', models.TextField(blank=True, verbose_name='시정조치')),
                ('preventive_action', models.TextField(blank=True, verbose_name='예방조치')),
                ('claim_cost', models.DecimalField(blank=True, decimal_places=0, max_digits=12, null=True, verbose_name='클레임비용')),
                ('verification_result', models.TextField(blank=True, verbose_name='효과검증 결과')),
                ('is_effective', models.BooleanField(blank=True, null=True, verbose_name='효과있음')),
                ('due_date', models.DateField(blank=True, null=True, verbose_name='처리기한')),
                ('closed_date', models.DateField(blank=True, null=True, verbose_name='완료일')),
                ('created_at', models.DateTimeField(auto_now_add=True, verbose_name='등록일시')),
                ('updated_at', models.DateTimeField(auto_now=True, verbose_name='수정일시')),
                ('assigned_to', models.ForeignKey(blank=True, null=True, on_delete=django.db.models.deletion.SET_NULL, related_name='voc_assigned', to=settings.AUTH_USER_MODEL, verbose_name='담당자')),
                ('linked_claim', models.ForeignKey(blank=True, null=True, on_delete=django.db.models.deletion.SET_NULL, related_name='voc_links', to='qms.vendorclaim', verbose_name='연계된 협력사 클레임')),
                ('linked_vendor', models.ForeignKey(blank=True, limit_choices_to={'org_type': 'VENDOR'}, null=True, on_delete=django.db.models.deletion.SET_NULL, to='orders.organization', verbose_name='귀책 협력사')),
                ('received_by', models.ForeignKey(on_delete=django.db.models.deletion.PROTECT, related_name='voc_received', to=settings.AUTH_USER_MODEL, verbose_name='접수자')),
            ],
            options={
                'verbose_name': 'VOC',
                'verbose_name_plural': 'VOC (고객의소리)',
                'ordering': ['-received_date', '-id'],
            },
        ),
        migrations.CreateModel(
            name='VOCAttachment',
            fields=[
                ('id', models.BigAutoField(auto_created=True, primary_key=True, serialize=False, verbose_name='ID')),
                ('file', models.FileField(upload_to='qms/voc/attachments/', verbose_name='파일')),
                ('file_name', models.CharField(max_length=200, verbose_name='파일명')),
                ('uploaded_at', models.DateTimeField(auto_now_add=True, verbose_name='업로드일시')),
                ('uploaded_by', models.ForeignKey(null=True, on_delete=django.db.models.deletion.SET_NULL, to=settings.AUTH_USER_MODEL)),
                ('voc', models.ForeignKey(on_delete=django.db.models.deletion.CASCADE, related_name='attachments', to='qms.voc')),
            ],
            options={
                'verbose_name': 'VOC첨부파일',
                'verbose_name_plural': 'VOC첨부파일',
            },
        ),
        migrations.CreateModel(
            name='DocumentRevision',
            fields=[
                ('id', models.BigAutoField(auto_created=True, primary_key=True, serialize=False, verbose_name='ID')),
                ('revision', models.IntegerField(verbose_name='개정차수')),
                ('version', models.CharField(max_length=20, verbose_name='버전')),
                ('change_reason', models.TextField(verbose_name='개정사유')),
                ('change_detail', models.TextField(verbose_name='개정내용')),
                ('previous_file', models.FileField(blank=True, null=True, upload_to='qms/documents/archive/', verbose_name='이전파일')),
                ('revised_at', models.DateTimeField(auto_now_add=True, verbose_name='개정일시')),
                ('revised_by', models.ForeignKey(null=True, on_delete=django.db.models.deletion.SET_NULL, to=settings.AUTH_USER_MODEL, verbose_name='개정자')),
                ('document', models.ForeignKey(on_delete=django.db.models.deletion.CASCADE, related_name='revisions', to='qms.qualitydocument', verbose_name='문서')),
            ],
            options={
                'verbose_name': '개정이력',
                'verbose_name_plural': '개정이력',
                'ordering': ['-revision'],
                'unique_together': {('document', 'revision')},
            },
        ),
    ]
